
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lib.auxiliary_functions &#8212; NGFW from Policy to Code 1.0.10 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/external-links.css?v=abeb5452" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=f08afc62"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/lib/auxiliary_functions';</script>
    <script src="../../_static/open-external-links.js?v=d6647550"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
     
  

<a class="navbar-brand logo" href="https://www.packtpub.com/en-gb/product/palo-alto-networks-from-policy-to-code-9781835881293">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/book-cover.png" class="logo__image only-light" alt="This project has a companion book published by Packt Publishing in August, 2025. Click here for more details (opens in the same window)."/>
    <script>document.write(`<img src="../../_static/book-cover.png" class="logo__image only-dark" alt="This project has a companion book published by Packt Publishing in August, 2025. Click here for more details (opens in the same window)."/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../customization.html">Customization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../defaults.html">Defaults</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../input_data_formats.html">Input Data Formats</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/service_objects.html">Service Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/edls.html">External Dynamic Lists (EDLs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/address_objects.html">Address Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/custom_url_categories.html">Custom URL Categories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/application_groups.html">Application Groups</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../object_types/security_profiles.html">Security Profiles</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../object_types/security_profiles/antivirus_profiles.html">Antivirus Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../object_types/security_profiles/anti_spyware_profiles.html">Anti-spyware Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../object_types/security_profiles/vulnerability_protection_profiles.html">Vulnerability Protection Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../object_types/security_profiles/url_filtering_profiles.html">URL Filtering Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../object_types/security_profiles/file_blocking_profiles.html">File Blocking Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../object_types/security_profiles/data_filtering_profiles.html">Data Filtering Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../object_types/security_profiles/wildfire_analysis_profiles.html">WildFire Analysis Profiles</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/tags.html">Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/decryption_profiles.html">Decryption Profiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/custom_applications.html">Custom Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/custom_vulnerability_signatures.html">Custom Vulnerability Signatures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/custom_spyware_signatures.html">Custom Spyware Signatures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../object_types/data_patterns.html">Data Patterns</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../response_pages.html">Response Pages</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">How to Use</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../scm_integration.html">Strata Cloud Manager (SCM)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../scm_api_comparison/index.html">Comparative Analysis: API Capabilities of Strata Cloud Manager vs Panorama</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../scm_api_comparison/introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_api_comparison/feature_parity.html">Feature Parity in Policy Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_api_comparison/api_structure.html">API Structure and Endpoint Differences</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_api_comparison/authentication.html">Authentication and Access Control Differences</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_api_comparison/deployment_model.html">Deployment Model: Commit vs Push Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_api_comparison/sdk_support.html">SDK Support and Tooling Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_api_comparison/migration_considerations.html">Migration Considerations and Code Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_api_comparison/references.html">References</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../scm_integration_details/index.html">SCM Integration Details</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../scm_integration_details/current_components.html">Current Panorama-Focused Deployment Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_integration_details/changes_needed.html">Changes Needed to Support SCM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_integration_details/integration_strategy.html">Integration Strategy (Panorama + SCM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_integration_details/key_differences.html">Key Differences to Address</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm_integration_details/summary.html">Summary</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../code.html">Source Code Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../lib/auxiliary_functions.html">Auxiliary Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lib/build_policy.html">Build Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lib/category_parser.html">Category Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lib/security_policy_pre.html">Security Policy Pre</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lib/security_policy_post.html">Security Policy Post</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for lib.auxiliary_functions</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Functions providing auxiliary utilities for PAN-OS policy management.</span>

<span class="sd">This module provides a collection of helper functions used throughout the project for:</span>

<span class="sd">- Parsing metadata from JSON and CSV files</span>
<span class="sd">- Finding differences between address objects and groups</span>
<span class="sd">- Executing multi-config API calls to PAN-OS devices</span>
<span class="sd">- Creating non-SDK objects in PAN-OS</span>
<span class="sd">- Handling file operations and error handling</span>
<span class="sd">- Supporting various data transformation and validation tasks</span>
<span class="sd">- Pluralizing words for consistent naming conventions</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">importlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os.path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xml.dom.minidom</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">importlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">metadata</span> <span class="k">as</span> <span class="n">metadata</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich</span><span class="w"> </span><span class="kn">import</span> <span class="nb">print</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.panel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Panel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.status</span><span class="w"> </span><span class="kn">import</span> <span class="n">Status</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lib.rich_output</span><span class="w"> </span><span class="kn">import</span> <span class="n">console</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">xmltodict</span><span class="w"> </span><span class="kn">import</span> <span class="n">unparse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">panos.errors</span><span class="w">   </span><span class="kn">import</span> <span class="n">PanDeviceXapiError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">panos.policies</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecurityRule</span><span class="p">,</span> <span class="n">DecryptionRule</span><span class="p">,</span> <span class="n">AuthenticationRule</span><span class="p">,</span> <span class="n">NatRule</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">panos.objects</span><span class="w"> </span><span class="kn">import</span> <span class="n">Edl</span><span class="p">,</span> <span class="n">ServiceObject</span><span class="p">,</span> <span class="n">ServiceGroup</span><span class="p">,</span> <span class="n">ApplicationGroup</span><span class="p">,</span> <span class="n">ApplicationFilter</span><span class="p">,</span> <span class="n">CustomUrlCategory</span><span class="p">,</span> \
    <span class="n">LogForwardingProfile</span><span class="p">,</span> <span class="n">Tag</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">lib.category_parser</span><span class="w">    </span><span class="kn">import</span> <span class="n">parse_app_categories</span><span class="p">,</span> <span class="n">parse_url_categories</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">settings</span>

<span class="c1"># Global variables</span>
<span class="n">menu_options</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">default_choice</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Module-level variable to track whether execute_multi_config_api_call has been called before</span>
<span class="n">_first_multi_config_call</span> <span class="o">=</span> <span class="kc">True</span>


<div class="viewcode-block" id="get_source_user_for_category">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.get_source_user_for_category">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_source_user_for_category</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">category_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches the source user associated with a given category and category type based on</span>
<span class="sd">    CSV files with business requirements. Only managed categories will be evaluated. In other</span>
<span class="sd">    words, you can use this function to retrieve UserID only for those categories that you decide to manage</span>
<span class="sd">    and declare as such in the business requirements CSV files.</span>

<span class="sd">    Args:</span>
<span class="sd">        category (str): The specific category to evaluate (e.g., subcategory for apps or</span>
<span class="sd">            a general category for URLs).</span>
<span class="sd">        category_type (str): The type of the category, which can be either &quot;app&quot; or &quot;url&quot;.</span>
<span class="sd">            Determines what kind of category will be processed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: The user ID that corresponds to the specified category and</span>
<span class="sd">            category type. Returns None if no match is found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        SystemExit: If the provided category type is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_user</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">category_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;app&quot;</span><span class="p">:</span>
        <span class="n">app_categories_requirements</span> <span class="o">=</span> <span class="n">parse_app_categories</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">APP_CATEGORIES_REQUIREMENTS_FILENAME</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">app_categories_requirements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;SubCategory&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">settings</span><span class="o">.</span><span class="n">APP_ACTION_MANAGE</span><span class="p">:</span>
                <span class="n">source_user</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;UserID&quot;</span><span class="p">]</span>
                <span class="k">break</span>
    <span class="k">elif</span> <span class="n">category_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span>
        <span class="n">url_categories_requirements</span> <span class="o">=</span> <span class="n">parse_url_categories</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">URL_CATEGORIES_REQUIREMENTS_FILENAME</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">url_categories_requirements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Category&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">settings</span><span class="o">.</span><span class="n">URL_ACTION_MANAGE</span><span class="p">:</span>
                <span class="n">source_user</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;UserID&quot;</span><span class="p">]</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid category type: </span><span class="si">{</span><span class="n">category_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">source_user</span></div>



<div class="viewcode-block" id="parse_metadata_from_json">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.parse_metadata_from_json">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_metadata_from_json</span><span class="p">(</span><span class="n">type_display_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">suppress_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses metadata from a JSON file.</span>

<span class="sd">    Args:</span>
<span class="sd">        type_display_name (str): A display name for the type of metadata being parsed.</span>
<span class="sd">        file_name (str): The path to the JSON file containing the metadata.</span>
<span class="sd">        suppress_output (bool): If True, suppresses output messages. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict or None: The parsed metadata as a dictionary, or None if the file does not exist or cannot be parsed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_output</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Metadata type :: &quot;</span> <span class="o">+</span> <span class="n">type_display_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; :: file is found - parsing data...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># reading the file into a dictionary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                 <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_output</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="si">}</span><span class="s1"> entries found.&#39;</span><span class="p">)</span>
        <span class="c1"># handle exceptions</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid JSON syntax:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The file was not found.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="ow">or</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to open the file (check if it&#39;s open in another program)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Metadata type :: &quot;</span> <span class="o">+</span> <span class="n">type_display_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; :: no files found&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">metadata</span></div>



<div class="viewcode-block" id="parse_metadata_from_yaml">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.parse_metadata_from_yaml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_metadata_from_yaml</span><span class="p">(</span><span class="n">type_display_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">suppress_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses metadata from a YAML file.</span>

<span class="sd">    Args:</span>
<span class="sd">        type_display_name (str): A display name for the type of metadata being parsed.</span>
<span class="sd">        file_name (str): The path to the YAML file containing the metadata.</span>
<span class="sd">        suppress_output (bool): If True, suppresses output messages. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict or None: The parsed metadata as a dictionary, or None if the file does not exist or cannot be parsed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_output</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Metadata type :: &quot;</span> <span class="o">+</span> <span class="n">type_display_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; :: file is found - parsing data...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># reading the file into a dictionary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">yaml_file</span><span class="p">:</span>
                 <span class="n">metadata</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_output</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="si">}</span><span class="s1"> entries found.&#39;</span><span class="p">)</span>
        <span class="c1"># handle exceptions</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid YAML syntax:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The file was not found.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="ow">or</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to open the file (check if it&#39;s open in another program)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Metadata type :: &quot;</span> <span class="o">+</span> <span class="n">type_display_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; :: no files found&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">metadata</span></div>



<div class="viewcode-block" id="parse_metadata_from_csv">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.parse_metadata_from_csv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_metadata_from_csv</span><span class="p">(</span><span class="n">type_display_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">suppress_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a CSV file with metadata of a profile/object of a given type.</span>

<span class="sd">    Read data is stored in a list of dictionaries (one dictionary per row</span>
<span class="sd">    with column names used as dictionary keys).</span>

<span class="sd">    Args:</span>
<span class="sd">        type_display_name (str): Type of the object (&quot;EDL&quot;, &quot;vulnerability&quot;, &quot;antivirus&quot;, etc.)</span>
<span class="sd">        file_name (str): Path to the CSV file containing metadata.</span>
<span class="sd">        suppress_output (bool, optional): If True, suppresses output messages. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list or None: A list of dictionaries containing the values read from the CSV.</span>
<span class="sd">            Returns None if the file does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_output</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Metadata type :: &quot;</span> <span class="o">+</span> <span class="n">type_display_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; :: parsing [</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">]...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># reading the file into a list of dictionaries</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
            <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
                <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_output</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="si">}</span><span class="s1"> entries found.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Metadata type :: &quot;</span> <span class="o">+</span> <span class="n">type_display_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; :: no files found&quot;</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">metadata</span></div>



<div class="viewcode-block" id="find_address_objects_delta">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.find_address_objects_delta">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_address_objects_delta</span><span class="p">(</span><span class="n">current_address_objects</span><span class="p">,</span> <span class="n">staged_address_objects</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_hashable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Convert list to tuple</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># Convert dict to frozenset</span>
        <span class="k">return</span> <span class="n">value</span>  <span class="c1"># Keep it as-is if it&#39;s already hashable</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_comparable_set</span><span class="p">(</span><span class="n">objects</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]),</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">description</span><span class="p">),</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span>
        <span class="p">)</span>

    <span class="c1"># Generate comparable sets</span>
    <span class="n">current_set</span> <span class="o">=</span> <span class="n">to_comparable_set</span><span class="p">(</span><span class="n">current_address_objects</span><span class="p">)</span>
    <span class="n">staged_set</span>  <span class="o">=</span> <span class="n">to_comparable_set</span><span class="p">(</span><span class="n">staged_address_objects</span><span class="p">)</span>

    <span class="c1"># Calculate deltas</span>
    <span class="n">in_current_not_in_staged</span> <span class="o">=</span> <span class="n">current_set</span> <span class="o">-</span> <span class="n">staged_set</span>
    <span class="n">in_staged_not_in_current</span> <span class="o">=</span> <span class="n">staged_set</span> <span class="o">-</span> <span class="n">current_set</span>

    <span class="c1"># Convert deltas back to original objects</span>
    <span class="n">delta_current</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">current_address_objects</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">description</span><span class="p">),</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">in_current_not_in_staged</span>
    <span class="p">]</span>

    <span class="n">delta_staged</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">staged_address_objects</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">description</span><span class="p">),</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">in_staged_not_in_current</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">delta_current</span><span class="p">,</span> <span class="n">delta_staged</span></div>



<div class="viewcode-block" id="find_address_groups_delta">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.find_address_groups_delta">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_address_groups_delta</span><span class="p">(</span><span class="n">current_address_groups</span><span class="p">,</span> <span class="n">staged_address_groups</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_hashable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Convert list to tuple</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>  <span class="c1"># Convert dict to frozenset</span>
        <span class="k">return</span> <span class="n">value</span>  <span class="c1"># Keep it as-is if it&#39;s already hashable</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_comparable_set</span><span class="p">(</span><span class="n">objects</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">static_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">static_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]),</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dynamic_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">dynamic_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]),</span>
                <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span>
        <span class="p">)</span>

    <span class="c1"># Generate comparable sets</span>
    <span class="n">current_set</span> <span class="o">=</span> <span class="n">to_comparable_set</span><span class="p">(</span><span class="n">current_address_groups</span><span class="p">)</span>
    <span class="n">staged_set</span> <span class="o">=</span> <span class="n">to_comparable_set</span><span class="p">(</span><span class="n">staged_address_groups</span><span class="p">)</span>

    <span class="c1"># Calculate deltas</span>
    <span class="n">in_current_not_in_staged</span> <span class="o">=</span> <span class="n">current_set</span> <span class="o">-</span> <span class="n">staged_set</span>
    <span class="n">in_staged_not_in_current</span> <span class="o">=</span> <span class="n">staged_set</span> <span class="o">-</span> <span class="n">current_set</span>

    <span class="c1"># Convert deltas back to original objects</span>
    <span class="n">delta_current</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">current_address_groups</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">static_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">static_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dynamic_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">dynamic_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">in_current_not_in_staged</span>
    <span class="p">]</span>

    <span class="n">delta_staged</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">staged_address_groups</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">static_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">static_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dynamic_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">dynamic_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]),</span>
            <span class="n">make_hashable</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">in_staged_not_in_current</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">delta_current</span><span class="p">,</span> <span class="n">delta_staged</span></div>



<div class="viewcode-block" id="delete_objects">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.delete_objects">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">delete_objects</span><span class="p">(</span><span class="n">panos_device</span><span class="p">,</span> <span class="n">objects_to_delete</span><span class="p">,</span> <span class="n">failure_mode</span><span class="o">=</span><span class="s2">&quot;hard&quot;</span><span class="p">,</span> <span class="n">transactional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes specified objects on a PAN-OS device using a multi-config API call.</span>

<span class="sd">    This function constructs an XML request to delete multiple objects of the specified</span>
<span class="sd">    types on a PAN-OS device. It supports various object types and generates a human-readable</span>
<span class="sd">    name for the objects being deleted. The function also provides options to handle failures</span>
<span class="sd">    and execute the operation transactionally.</span>

<span class="sd">    Args:</span>
<span class="sd">        panos_device: The PAN-OS device on which the objects will be deleted.</span>
<span class="sd">        objects_to_delete: A list of objects to delete. Each object must have a `xpath` method</span>
<span class="sd">            that returns the XPath of the object on the device.</span>
<span class="sd">        failure_mode: Specifies how failures should be handled during the deletion process.</span>
<span class="sd">            Defaults to &quot;hard&quot;.</span>
<span class="sd">        transactional: A boolean indicating whether the deletion should be executed transactionally.</span>
<span class="sd">            This means that when a commit operation is active or a commit is pending, the operation will fail.</span>
<span class="sd">            When there are uncommitted changes for the user performing the operation,</span>
<span class="sd">            they will be rolled back before performing the operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">objects_to_delete</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">objects_to_delete</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Initialize a starting action ID (arbitrary number that increments for each element)</span>
        <span class="n">action_id</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Construct multi-config XML</span>
        <span class="n">multi_config_xml</span> <span class="o">=</span> <span class="s1">&#39;&lt;multi-config&gt;&#39;</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objects_to_delete</span><span class="p">:</span>
            <span class="n">multi_config_xml</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;delete id=&quot;</span><span class="si">{</span><span class="n">action_id</span><span class="si">}</span><span class="s1">&quot; xpath=&quot;</span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">xpath</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;/delete&gt;&#39;</span>
            <span class="n">action_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">multi_config_xml</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/multi-config&gt;&#39;</span>

        <span class="c1"># Map classes to their desired display strings</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">SecurityRule</span><span class="p">:</span>           <span class="s2">&quot;security rule&quot;</span><span class="p">,</span>
            <span class="n">DecryptionRule</span><span class="p">:</span>         <span class="s2">&quot;decryption rule&quot;</span><span class="p">,</span>
            <span class="n">NatRule</span><span class="p">:</span>                <span class="s2">&quot;NAT rule&quot;</span><span class="p">,</span>
            <span class="n">AuthenticationRule</span><span class="p">:</span>     <span class="s2">&quot;authentication rule&quot;</span><span class="p">,</span>
            <span class="n">Edl</span><span class="p">:</span>                    <span class="s2">&quot;EDL&quot;</span><span class="p">,</span>
            <span class="n">ServiceObject</span><span class="p">:</span>          <span class="s2">&quot;service&quot;</span><span class="p">,</span>
            <span class="n">ServiceGroup</span><span class="p">:</span>           <span class="s2">&quot;service group&quot;</span><span class="p">,</span>
            <span class="n">ApplicationGroup</span><span class="p">:</span>       <span class="s2">&quot;application group&quot;</span><span class="p">,</span>
            <span class="n">ApplicationFilter</span><span class="p">:</span>      <span class="s2">&quot;application filter&quot;</span><span class="p">,</span>
            <span class="n">CustomUrlCategory</span><span class="p">:</span>      <span class="s2">&quot;custom URL category&quot;</span><span class="p">,</span>
            <span class="n">LogForwardingProfile</span><span class="p">:</span>   <span class="s2">&quot;log forwarding profile&quot;</span><span class="p">,</span>
            <span class="n">Tag</span><span class="p">:</span>                    <span class="s2">&quot;tag&quot;</span>
        <span class="p">}</span>

        <span class="c1"># Let&#39;s create a human-friendly name of the objects we&#39;re deleting</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">objects_to_delete</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Unmapped type &#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;. Falling back to default naming.&quot;</span><span class="p">)</span>
            <span class="n">obj_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj_name</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Let&#39;s go crazy and make the name plural if we have more than one object :)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">objects_to_delete</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">obj_name</span><span class="o">=</span><span class="n">pluralize</span><span class="p">(</span><span class="n">obj_name</span><span class="p">)</span>

        <span class="c1"># Now we execute the multi-config request</span>
        <span class="n">execute_multi_config_api_call</span><span class="p">(</span><span class="n">panos_device</span><span class="p">,</span> <span class="n">multi_config_xml</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Deleting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">objects_to_delete</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">failure_mode</span><span class="p">,</span> <span class="n">transactional</span><span class="p">)</span></div>



<div class="viewcode-block" id="delete_non_sdk_objects">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.delete_non_sdk_objects">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">delete_non_sdk_objects</span><span class="p">(</span><span class="n">object_container</span><span class="p">,</span> <span class="n">panos_device</span><span class="p">,</span> <span class="n">objects_to_delete</span><span class="o">=</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function enumerates and deletes objects of specified types that do not have standard classes</span>
<span class="sd">    in the PAN-OS SDK for Python. It uses a preset dictionary to lookup XPATHs for each object type.</span>

<span class="sd">    Args:</span>
<span class="sd">        object_container (ObjectContainer): The container representing configuration</span>
<span class="sd">            components to retrieve their XPath.</span>
<span class="sd">        panos_device (PanOSDevice): The device object used to interact with PAN-OS</span>
<span class="sd">            firewalls or Panorama via API.</span>
<span class="sd">        objects_to_delete (tuple): A tuple containing the types of objects to delete, as</span>
<span class="sd">            defined in the `object_types` dictionary keys.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If the deletion operation fails, or if objects fail to enumerate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">panos_device</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">object_container</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Discovering and deleting objects prior to their (re)creation...&quot;</span><span class="p">)</span>

    <span class="c1"># As of Python version 3.7, dictionaries are ordered. In Python 3.6 and earlier, dictionaries are unordered.</span>
    <span class="c1"># therefore it&#39;s important to run this code with v3.7 or later as the profile groups must be deleted before</span>
    <span class="c1"># the profiles themselves</span>

    <span class="n">object_types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;profile-group&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;profile groups&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profile-group&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;profile-group&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;vulnerability&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;vulnerability profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/vulnerability&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;vulnerability&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;virus&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;antivirus profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/virus&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;virus&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;spyware&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;anti-spyware profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/spyware&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;spyware&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;wildfire-analysis&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;wildfire analysis profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/wildfire-analysis&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;wildfire-analysis&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;file-blocking&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;file blocking profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/file-blocking&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;file-blocking&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;data-filtering&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;data filtering profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/data-filtering&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;data-filtering&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;data-objects&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;custom data patterns&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/data-objects&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;data-objects&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;url-filtering&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;URL filtering profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/url-filtering&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;url-filtering&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;application-tag&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;tagged applications&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;application-tag&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;application-tag&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;application&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;custom application signatures&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;application&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;application&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;threat-vulnerability&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;custom vulnerability signatures&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;threats/vulnerability&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;vulnerability&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;threat-spyware&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;custom spyware signatures&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;threats/spyware&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="s1">&#39;spyware&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;decryption&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;decryption profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span> <span class="s1">&#39;profiles/decryption&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;decryption&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">action_id</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">multi_config_xml</span> <span class="o">=</span> <span class="s1">&#39;&lt;multi-config&gt;&#39;</span>

    <span class="k">for</span> <span class="n">obj_key</span><span class="p">,</span> <span class="n">obj_details</span> <span class="ow">in</span> <span class="n">object_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">obj_key</span> <span class="ow">in</span> <span class="n">objects_to_delete</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enumerating </span><span class="si">{</span><span class="n">obj_details</span><span class="p">[</span><span class="s1">&#39;display_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">xpath</span> <span class="o">=</span> <span class="n">object_container</span><span class="o">.</span><span class="n">xpath</span><span class="p">()</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">obj_details</span><span class="p">[</span><span class="s1">&#39;xpath&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">profile_objects</span> <span class="o">=</span> <span class="n">panos_device</span><span class="o">.</span><span class="n">xapi</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">xpath</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">profile_objects</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">all_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">profile_objects</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;success&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">VERBOSE_OUTPUT</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="n">num_of_entries</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">profile_objects</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.//</span><span class="si">{</span><span class="n">obj_details</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;entry&quot;</span><span class="p">):</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                        <span class="n">all_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">num_of_entries</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">VERBOSE_OUTPUT</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">VERBOSE_OUTPUT</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">num_of_entries</span><span class="si">}</span><span class="s2"> entries found and staged for deletion)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; (failed to enumerate objects)&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">all_names</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">all_names</span><span class="p">:</span>
                    <span class="n">obj_xpath</span> <span class="o">=</span> <span class="n">object_container</span><span class="o">.</span><span class="n">xpath</span><span class="p">()</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">obj_details</span><span class="p">[</span><span class="s1">&#39;xpath&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/entry[@name=&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;]&quot;</span>
                    <span class="n">multi_config_xml</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;delete id=&quot;</span><span class="si">{</span><span class="n">action_id</span><span class="si">}</span><span class="s1">&quot; xpath=&quot;</span><span class="si">{</span><span class="n">obj_xpath</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;/delete&gt;&#39;</span>
                    <span class="n">action_id</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">multi_config_xml</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/multi-config&gt;&#39;</span>
    <span class="n">execute_multi_config_api_call</span><span class="p">(</span><span class="n">panos_device</span><span class="p">,</span> <span class="n">multi_config_xml</span><span class="p">,</span> <span class="s2">&quot;Deleting all staged objects...&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_non_sdk_objects">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.create_non_sdk_objects">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_non_sdk_objects</span><span class="p">(</span><span class="n">object_container</span><span class="p">,</span> <span class="n">panos_device</span><span class="p">,</span> <span class="n">objects_to_create</span><span class="o">=</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates non-SDK objects (such as security and decryption profiles) in a specified VSYS or Device Group</span>
<span class="sd">    of a firewall or Panorama. Objects must be pre-created in a JSON format in pre-configured folders</span>
<span class="sd">    defined in the Settings module. The function generates XML code for all required objects which is</span>
<span class="sd">    then applied to the target device using a multi-config API call.</span>

<span class="sd">    Args:</span>
<span class="sd">        object_container: Vsys or Device Group object where the objects will be created.</span>

<span class="sd">        panos_device: Firewall or Panorama object representing the target device.</span>

<span class="sd">        objects_to_create: An iterable containing keys representing the types of objects</span>
<span class="sd">            to create. Each key must match an available object type defined in `object_types`.</span>
<span class="sd">            Examples include &#39;vuln-profiles&#39;, &#39;av-profiles&#39;, &#39;spyware-profiles&#39;, etc. If invalid</span>
<span class="sd">            object types are included, a `ValueError` is raised.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any of the specified `objects_to_create` are not present in the pre-defined</span>
<span class="sd">            `object_types`, the function raises an exception listing the invalid types.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">object_types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;vulnerability-profiles&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;vulnerability profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/vulnerability&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span>       <span class="n">settings</span><span class="o">.</span><span class="n">SECURITY_PROFILES_VULNERABILITY_FOLDER</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;av-profiles&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;antivirus profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/virus&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span>       <span class="n">settings</span><span class="o">.</span><span class="n">SECURITY_PROFILES_ANTIVIRUS_FOLDER</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;spyware-profiles&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;anti-spyware profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/spyware&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span>       <span class="n">settings</span><span class="o">.</span><span class="n">SECURITY_PROFILES_ANTISPYWARE_FOLDER</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;wf-profiles&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;wildfire analysis profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/wildfire-analysis&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span>       <span class="n">settings</span><span class="o">.</span><span class="n">SECURITY_PROFILES_WILDFIRE_FOLDER</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;file-profiles&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;file blocking profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/file-blocking&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span>       <span class="n">settings</span><span class="o">.</span><span class="n">SECURITY_PROFILES_FILE_BLOCKING_FOLDER</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;data-patterns&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;custom data patterns&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/data-objects&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span>       <span class="n">settings</span><span class="o">.</span><span class="n">DATA_PATTERNS_FOLDER</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;data-profiles&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;data filtering profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/data-filtering&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span>       <span class="n">settings</span><span class="o">.</span><span class="n">SECURITY_PROFILES_DATA_FILTERING_FOLDER</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;url-profiles&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;URL filtering profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/url-filtering&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span>       <span class="n">settings</span><span class="o">.</span><span class="n">SECURITY_PROFILES_URL_FILTERING_FOLDER</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;decryption-profiles&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;decryption profiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span>        <span class="s1">&#39;profiles/decryption&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span>       <span class="n">settings</span><span class="o">.</span><span class="n">DECRYPTION_PROFILES_FOLDER</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># Validate objects_to_create</span>
    <span class="n">invalid_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects_to_create</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">object_types</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">invalid_objects</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid object types specified: </span><span class="si">{</span><span class="n">invalid_objects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Output the names of the staged objects</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Staging objects for creation:&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">object_types</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="s1">&#39;display_name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects_to_create</span><span class="p">))</span>

    <span class="c1"># Initialiase a counter and multi-config XML</span>
    <span class="n">action_id</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">multi_config_xml</span> <span class="o">=</span> <span class="s2">&quot;&lt;multi-config&gt;&quot;</span>

    <span class="c1"># Loop through all types of the objects that must be created</span>
    <span class="k">for</span> <span class="n">obj_type</span> <span class="ow">in</span> <span class="n">objects_to_create</span><span class="p">:</span>
        <span class="c1"># Get object info</span>
        <span class="n">obj_type_info</span> <span class="o">=</span> <span class="n">object_types</span><span class="p">[</span><span class="n">obj_type</span><span class="p">]</span>
        <span class="c1"># Get object&#39;s relative XPath (from the object info)</span>
        <span class="n">obj_xpath</span>     <span class="o">=</span> <span class="n">object_container</span><span class="o">.</span><span class="n">xpath</span><span class="p">()</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">obj_type_info</span><span class="p">[</span><span class="s1">&#39;xpath&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># List all files in the given folder and analyze JSON and YAML files</span>
        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">obj_type_info</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.yaml&#39;</span><span class="p">):</span>  <span class="c1"># Checks for .json or .yaml extension</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj_type_info</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="c1"># read data from the file (JSON or YAML)</span>
                    <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
                        <span class="n">object_definition</span> <span class="o">=</span> <span class="n">parse_metadata_from_json</span><span class="p">(</span><span class="n">obj_type_info</span><span class="p">[</span><span class="s1">&#39;display_name&#39;</span><span class="p">],</span> <span class="n">file_path</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">object_definition</span> <span class="o">=</span> <span class="n">parse_metadata_from_yaml</span><span class="p">(</span><span class="n">obj_type_info</span><span class="p">[</span><span class="s1">&#39;display_name&#39;</span><span class="p">],</span> <span class="n">file_path</span><span class="p">)</span>
                    <span class="c1"># now the &#39;object_definition&#39; variable contains definition of the object in a form of a dictionary</span>
                    <span class="k">if</span> <span class="n">object_definition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="n">object_definition</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">][</span><span class="s1">&#39;@name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="c1"># then we construct the element</span>
                        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG_OUTPUT</span><span class="p">:</span>
                            <span class="c1"># if DEBUG_OUTPUT is enabled we generate the element with pretty formatting</span>
                            <span class="n">obj_element</span> <span class="o">=</span> <span class="n">unparse</span><span class="p">(</span><span class="n">object_definition</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">full_document</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="c1"># and output the object&#39;s definition to the console</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Staged multi-config op #</span><span class="si">{</span><span class="n">action_id</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">obj_element</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># if DEBUG_OUTPUT is not required, we generate the XML code in a condensed non-pretty form</span>
                            <span class="n">obj_element</span> <span class="o">=</span> <span class="n">unparse</span><span class="p">(</span><span class="n">object_definition</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">full_document</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="c1"># we add the object definition to the multiconfig XML</span>
                        <span class="n">multi_config_xml</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;set id=&quot;</span><span class="si">{</span><span class="n">action_id</span><span class="si">}</span><span class="s1">&quot; xpath=&quot;</span><span class="si">{</span><span class="n">obj_xpath</span><span class="si">}</span><span class="s1">&quot;&gt;</span><span class="si">{</span><span class="n">obj_element</span><span class="si">}</span><span class="s1">&lt;/set&gt;&#39;</span>
                        <span class="c1"># and increment the counter</span>
                        <span class="n">action_id</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># this is a &quot;soft&quot; error that would be displayed when the object definition</span>
                        <span class="c1"># has failed to be read from the JSON file</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Profile data failed to be read from &#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="c1"># Then we repeat the loop for the next file (= object definition) found in the folder</span>
        <span class="c1"># Then we repeat the loop for the next object type</span>
    <span class="c1"># Once we&#39;ve finished with all object type we add a closing tag to the multi-config XML code</span>
    <span class="n">multi_config_xml</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/multi-config&gt;&#39;</span>
    <span class="c1"># and execute the code (all objects will be created in one large multi_config API call)</span>
    <span class="n">execute_multi_config_api_call</span><span class="p">(</span><span class="n">panos_device</span><span class="p">,</span> <span class="n">multi_config_xml</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Creating the staged objects...&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>



<div class="viewcode-block" id="execute_multi_config_api_call">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.execute_multi_config_api_call">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">execute_multi_config_api_call</span><span class="p">(</span><span class="n">panos_device</span><span class="p">,</span> <span class="n">multi_config_xml</span><span class="p">,</span> <span class="n">output_message</span><span class="p">,</span> <span class="n">indentation_level</span><span class="p">,</span> <span class="n">failure_mode</span><span class="o">=</span><span class="s2">&quot;hard&quot;</span><span class="p">,</span> <span class="n">strict_transactional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a multi-configuration API call on a specified PAN-OS device.</span>

<span class="sd">    This function performs an API call to send a multi-configuration XML to a PAN-OS device.</span>
<span class="sd">    It manages the communication, logs the results, measures the execution time, and calculates</span>
<span class="sd">    average operation time if applicable. The function supports both strict and non-strict</span>
<span class="sd">    transactional modes.</span>
<span class="sd">    If an error occurs and the failure mode is set to `hard`, the</span>
<span class="sd">    program will terminate.</span>

<span class="sd">    Args:</span>
<span class="sd">        panos_device: The PAN-OS device object to which the API call will be sent.</span>
<span class="sd">        `multi_config_xml`: The XML string containing the multi-configuration data to apply.</span>
<span class="sd">        output_message: The base output message to display during execution.</span>
<span class="sd">        indentation_level: The indentation level for the output display, used to control</span>
<span class="sd">            formatting in the console.</span>
<span class="sd">        failure_mode: The failure mode behavior if an error occurs during execution.</span>
<span class="sd">            Options are `hard` (default) or other user-specified modes.</span>
<span class="sd">        strict_transactional: Flag to indicate whether to use strict transactional mode</span>
<span class="sd">            for applying the configuration.</span>
<span class="sd">            This means that when a commit operation is active or a commit is pending, the operation will fail.</span>
<span class="sd">            When there are uncommitted changes for the user performing the operation,</span>
<span class="sd">            they will be rolled back before performing the operation.</span>
<span class="sd">            Defaults to `False`.</span>
<span class="sd">            This parameter can be overridden by the global flag MAKE_THE_FIRST_MULTI_CONFIG_TRANSACTIONAL</span>
<span class="sd">            for the first call to always be True.</span>
<span class="sd">            This is the default behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_first_multi_config_call</span>

    <span class="c1"># Override strict_transactional for the first call</span>
    <span class="k">if</span> <span class="n">_first_multi_config_call</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">MAKE_THE_FIRST_MULTI_CONFIG_TRANSACTIONAL</span><span class="p">:</span>
        <span class="n">strict_transactional</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">_first_multi_config_call</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Log API calls if enabled</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">LOG_API_CALLS</span><span class="p">:</span>
        <span class="c1"># Get current timestamp</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>

        <span class="c1"># Determine file mode (overwrite or append)</span>
        <span class="n">file_mode</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span> <span class="k">if</span> <span class="n">strict_transactional</span> <span class="k">else</span> <span class="s2">&quot;a&quot;</span>

        <span class="c1"># Log the API call to file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">API_CALLS_LOG_FILENAME</span><span class="p">,</span> <span class="n">file_mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;============== API Call at </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> ====================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Strict Transactional:      </span><span class="si">{</span><span class="n">strict_transactional</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Associated output message: </span><span class="si">{</span><span class="n">output_message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;XML Content (formatted for readability):</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Pretty print the XML content</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Parse the XML string and format it with proper indentation</span>
                <span class="n">dom</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">multi_config_xml</span><span class="p">)</span>
                <span class="n">pretty_xml</span> <span class="o">=</span> <span class="n">dom</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>

                <span class="c1"># Remove XML declaration line</span>
                <span class="k">if</span> <span class="n">pretty_xml</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&lt;?xml&#39;</span><span class="p">):</span>
                    <span class="n">pretty_xml</span> <span class="o">=</span> <span class="n">pretty_xml</span><span class="p">[</span><span class="n">pretty_xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;?&gt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

                <span class="c1"># Remove empty lines</span>
                <span class="n">pretty_xml</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pretty_xml</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pretty_xml</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Fallback to original XML if parsing fails</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error formatting XML: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">multi_config_xml</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">tabs</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="n">indentation_level</span>
    <span class="n">status_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tabs</span><span class="si">}{</span><span class="n">output_message</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">strict_transactional</span><span class="p">:</span>
        <span class="n">status_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status_message</span><span class="si">}</span><span class="s2"> ([bold]strict transactional mode[/bold])&quot;</span>

    <span class="n">final_status_message</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">console</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">status_message</span><span class="p">,</span> <span class="n">spinner</span><span class="o">=</span><span class="s2">&quot;dots&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">status_spinner</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">panos_device</span><span class="o">.</span><span class="n">xapi</span><span class="o">.</span><span class="n">multi_config</span><span class="p">(</span><span class="n">multi_config_xml</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="n">strict_transactional</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="c1"># Calculate elapsed time in seconds and milliseconds (without tenths)</span>
            <span class="n">total_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">)</span>
            <span class="n">total_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">elapsed_time</span> <span class="o">-</span> <span class="n">total_sec</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

            <span class="c1"># Count number of operations (occurrences of &quot; id=&quot; in the XML)</span>
            <span class="n">num_operations</span> <span class="o">=</span> <span class="n">multi_config_xml</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot; id=&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_operations</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">avg_time</span> <span class="o">=</span> <span class="n">elapsed_time</span> <span class="o">/</span> <span class="n">num_operations</span>
                <span class="n">avg_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">avg_time</span><span class="p">)</span>
                <span class="n">avg_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">avg_time</span> <span class="o">-</span> <span class="n">avg_sec</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="n">avg_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_sec</span><span class="si">}</span><span class="s2">s </span><span class="si">{</span><span class="n">avg_ms</span><span class="si">}</span><span class="s2">ms&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">avg_str</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>

            <span class="c1"># Update the status with a green tick if successful</span>
            <span class="n">result_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">total_sec</span><span class="si">}</span><span class="s1">s </span><span class="si">{</span><span class="n">total_ms</span><span class="si">}</span><span class="s1">ms, </span><span class="si">{</span><span class="n">num_operations</span><span class="si">}</span><span class="s1"> ops, AVG: </span><span class="si">{</span><span class="n">avg_str</span><span class="si">}</span><span class="s1"> per op)&#39;</span>
            <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span>
                <span class="n">final_status_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status_message</span><span class="si">}</span><span class="s2"> [green][/green] </span><span class="si">{</span><span class="n">result_message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">final_status_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status_message</span><span class="si">}</span><span class="s2"> [yellow]![/yellow] </span><span class="si">{</span><span class="n">result_message</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">status_spinner</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">final_status_message</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">LOG_API_CALLS</span><span class="p">:</span>
                <span class="c1"># Get current timestamp</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>

                <span class="c1"># Log the API responses to file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">API_CALLS_LOG_FILENAME</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- API Response at </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result: </span><span class="si">{</span><span class="n">result_message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;PAN-OS detailed response:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># Output the result to the file</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">status</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.//response&#39;</span><span class="p">):</span>
                            <span class="n">resp_status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>
                            <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
                            <span class="n">action_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;msg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;msg&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">ID: </span><span class="si">{</span><span class="n">action_id</span><span class="si">}</span><span class="s2">, Status: </span><span class="si">{</span><span class="n">resp_status</span><span class="si">}</span><span class="s2">, Code: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">, Msg: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG_OUTPUT</span><span class="p">:</span>
                                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tabs</span><span class="si">}</span><span class="s2">ID: </span><span class="si">{</span><span class="n">action_id</span><span class="si">}</span><span class="s2">, Status: </span><span class="si">{</span><span class="n">resp_status</span><span class="si">}</span><span class="s2">, Code: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">, Msg: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;==================================================================</span><span class="se">\n\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error writing the response to the file &#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">API_CALLS_LOG_FILENAME</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">PanDeviceXapiError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;-- XML API error --&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">API_ERROR_LOG_FILENAME</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;If the message above appears truncated, review the log file [</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">API_ERROR_LOG_FILENAME</span><span class="si">}</span><span class="s2">] for the full error message.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">failure_mode</span> <span class="o">==</span> <span class="s2">&quot;hard&quot;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Print the final status message after the context manager exits</span>
    <span class="k">if</span> <span class="n">final_status_message</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">final_status_message</span><span class="p">)</span></div>



<div class="viewcode-block" id="load_module_from_file">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.load_module_from_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_module_from_file</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a Python module from a specified file path using its module name.</span>

<span class="sd">    This function uses the importlib.util module to dynamically load a module</span>
<span class="sd">    by creating a module spec from the provided file path and then executing</span>
<span class="sd">    the module code within that spec. It then returns the loaded module object</span>
<span class="sd">    to the caller.</span>

<span class="sd">    Args:</span>
<span class="sd">        module_name: Name of the module as a string. This is the name under</span>
<span class="sd">            which the module will be available upon loading.</span>
<span class="sd">        file_path: Path to the module file as a string. This is the location on</span>
<span class="sd">            the filesystem from which the module will be loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The loaded module object, which can be used to access functions,</span>
<span class="sd">        classes, or variables defined in the module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module</span></div>



<div class="viewcode-block" id="find_and_import_rules">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.find_and_import_rules">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_and_import_rules</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds and imports rule definitions from Python files within a given directory.</span>

<span class="sd">    This function searches through a directory structure, looking for files named</span>
<span class="sd">    `rules.py`. It attempts to import these files as modules, and if successful,</span>
<span class="sd">    it checks for the presence of `section_rules` and `section_defaults`</span>
<span class="sd">    attributes. When found, it merges each security rule with the default</span>
<span class="sd">    settings, ensuring the attributes set in the rule take priority over the default values.</span>
<span class="sd">    The function collects all the processed rules and their corresponding subfolder names for</span>
<span class="sd">    further use.</span>

<span class="sd">    Optionally, the function validates rule names and descriptions to ensure they comply</span>
<span class="sd">    with the naming convention set in the `settings` module.</span>

<span class="sd">    Args:</span>
<span class="sd">        directory (str): The root directory to search for &#39;rules.py&#39; files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing two elements:</span>
<span class="sd">            - A list of dictionaries, where each dictionary represents a security</span>
<span class="sd">              rule merged with default settings.</span>
<span class="sd">            - A list of strings, where each string is the name of the subfolder</span>
<span class="sd">              containing the corresponding rule file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_subfolder_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_of_invalid_rules</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Traverse the directory structure</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="c1"># Sort directories and files to ensure a consistent processing order</span>
        <span class="n">dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;rules.py&quot;</span><span class="p">:</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="c1"># Normalize the path to ensure consistency in slashes</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="c1"># Create a unique module name based on the file path</span>
                <span class="c1"># first, we remove the file extension</span>
                <span class="n">module_name</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="c1"># second, we substitute all slashes, dots and spaces with the underscore</span>
                <span class="n">module_name_normilized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[ /.</span><span class="se">\\</span><span class="s2">-]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">module_name</span><span class="p">)</span>
                <span class="c1"># finally, we Load the module from the normalized file path</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="n">load_module_from_file</span><span class="p">(</span><span class="n">module_name_normilized</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;!!! Syntax error in rule definitions in the file: &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Check if &#39;section_rules&#39; and &#39;section_defaults&#39; are present</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;section_rules&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;section_defaults&#39;</span><span class="p">):</span>
                    <span class="c1"># Merge defaults with each rule, ensuring not to overwrite existing keys</span>
                    <span class="n">updated_rules</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">folder_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>  <span class="c1"># Get the subfolder name</span>
                    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">section_rules</span><span class="p">:</span>
                        <span class="c1"># Start with a copy of the defaults</span>
                        <span class="n">merged_rule</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">section_defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="c1"># Update the merged rule with the actual rule, preserving the rule&#39;s original keys</span>
                        <span class="n">merged_rule</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
                        <span class="c1"># Now the merged_rule is a dictionary that describes the rule that is going to be created</span>
                        <span class="c1"># here you can add some code</span>
                        <span class="c1"># that validates the complaince of the rule with your requirements</span>
                        <span class="c1"># such as a naming convention or a presence of a non-default description</span>

                        <span class="c1"># ------ validation code starts -----</span>
                        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">PERFORM_VALIDATION_CHECKS</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">VALIDATE_RULE_NAMES</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_string_for_compliance</span><span class="p">(</span><span class="n">merged_rule</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                                  <span class="n">settings</span><span class="o">.</span><span class="n">VALIDATION_PATTERN_FOR_RULE_NAMES</span><span class="p">,</span>
                                                                  <span class="s2">&quot;rule name&quot;</span><span class="p">,</span>
                                                                  <span class="s2">&quot;is not compliant with the naming convention&quot;</span><span class="p">):</span>
                                <span class="n">list_of_invalid_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merged_rule</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">PERFORM_VALIDATION_CHECKS</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">VALIDATE_RULE_DESCRIPTIONS</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_string_for_compliance</span><span class="p">(</span><span class="n">merged_rule</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                                                           <span class="n">settings</span><span class="o">.</span><span class="n">VALIDATION_PATTERN_FOR_RULE_DESCRIPTIONS</span><span class="p">,</span>
                                                           <span class="s2">&quot;rule description&quot;</span><span class="p">,</span>
                                                           <span class="s2">&quot;is not compliant with the naming convention (must be from 12 to 1024 characters long)&quot;</span><span class="p">):</span>
                                <span class="n">list_of_invalid_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merged_rule</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                        <span class="c1"># ------ validation code ends -------</span>

                        <span class="c1"># append the rule to the list of rules</span>
                        <span class="n">updated_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merged_rule</span><span class="p">)</span>
                        <span class="n">all_subfolder_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>  <span class="c1"># Append folder name for each rule</span>
                    <span class="n">all_rules</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">updated_rules</span><span class="p">)</span>

    <span class="c1"># validation action (after we parsed all rules in all folders)</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">PERFORM_VALIDATION_CHECKS</span> <span class="ow">and</span> <span class="n">list_of_invalid_rules</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Here is the list of all policy rules with invalid name and/or description: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">list_of_invalid_rules</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You can make the script terminate on validation errors by setting the [bold]SOFT_VALIDATION_ONLY[/bold] flag to [bold]False[/bold].&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">SOFT_VALIDATION_ONLY</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The validation errors are causing the program to exit now (you can change &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;this behavior by setting the [bold]SOFT_VALIDATION_ONLY[/bold] setting to [bold]True[/bold]).&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;It&#39;s recommended you roll back all changes made by the script, fix &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;the issue in the code and restart the script.&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All changes made can be rolled back by issuing the command &#39;[bold italic]load config &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;from running-config.xml[/bold italic]&#39; in the CLI &#39;[bold italic]configure[/bold italic]&#39; mode.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_rules</span><span class="p">,</span> <span class="n">all_subfolder_names</span></div>



<div class="viewcode-block" id="validate_string_for_compliance">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.validate_string_for_compliance">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_string_for_compliance</span><span class="p">(</span><span class="n">string_to_validate</span><span class="p">,</span> <span class="n">regex_pattern</span><span class="p">,</span> <span class="n">validated_entity_name</span><span class="p">,</span> <span class="n">message_to_display_if_no_match</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates a string against a given regex pattern and displays a message if the validation fails.</span>

<span class="sd">    This function checks whether the provided string matches a specified regular expression pattern.</span>
<span class="sd">    If the string does not match, a validation error message is displayed using formatted console output.</span>
<span class="sd">    The function then returns `False` to indicate non-compliance. Otherwise, it returns `True` when the</span>
<span class="sd">    string is fully compliant.</span>

<span class="sd">    Args:</span>
<span class="sd">        string_to_validate: The string to be validated against the provided regex pattern.</span>
<span class="sd">        regex_pattern: A regular expression pattern that the string should match.</span>
<span class="sd">        validated_entity_name: The name of the entity being validated, used for generating meaningful</span>
<span class="sd">            error messages.</span>
<span class="sd">        message_to_display_if_no_match: A message that will be appended in the console output when</span>
<span class="sd">            validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compile the passed regex pattern</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex_pattern</span><span class="p">)</span>
    <span class="c1"># Check if there is a match</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">string_to_validate</span><span class="p">):</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold red]Validation Error:[/bold red] &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">validated_entity_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;[bold]&#39;</span><span class="si">{</span><span class="n">string_to_validate</span><span class="si">}</span><span class="s2">&#39;[/bold] &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message_to_display_if_no_match</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span> <span class="c1"># Return False to take action in the main code</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="c1"># Return if the string is compliant with the pattern</span></div>



<div class="viewcode-block" id="pluralize">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.pluralize">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pluralize</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a singular word to its plural form.</span>

<span class="sd">    This function handles the pluralization of singular words based on specific</span>
<span class="sd">    conditions. If the word ends with a &#39;y&#39; and is preceded by a consonant, it changes</span>
<span class="sd">    &#39;y&#39; to &#39;ies&#39;. Otherwise, it simply adds &#39;s&#39; for pluralization.</span>

<span class="sd">    Args:</span>
<span class="sd">        word (str): A singular English word that needs to be converted to its</span>
<span class="sd">            plural form.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The pluralized form of the input word.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;y$&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[aeiou]y$&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;y$&#39;</span><span class="p">,</span> <span class="s1">&#39;ies&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">word</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span></div>



<div class="viewcode-block" id="version_tuple">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.version_tuple">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">version_tuple</span><span class="p">(</span><span class="n">version_str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a version string to a tuple of integers for comparison.</span>

<span class="sd">    Args:</span>
<span class="sd">        version_str (str): Version string in format &quot;x.y.z&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Tuple of integers representing the version</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">version_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)))</span></div>



<div class="viewcode-block" id="load_menu_options">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.load_menu_options">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_menu_options</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads menu options (policy targets) from a JSON file defined by the global</span>
<span class="sd">    constant `POLICY_TARGETS_FILENAME`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict or None: The loaded menu options or None if loading failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">menu_options</span>

    <span class="c1"># Check if installed module versions meet minimum requirements</span>
    <span class="n">pan_os_python_version</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="s2">&quot;pan-os-python&quot;</span><span class="p">)</span>
    <span class="n">pan_python_version</span>    <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="s2">&quot;pan-python&quot;</span><span class="p">)</span>

    <span class="c1"># Display version information if verbose output is enabled</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">VERBOSE_OUTPUT</span><span class="p">:</span>
        <span class="n">version_info</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pan-os-python: v</span><span class="si">{</span><span class="n">pan_os_python_version</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">pan-python:    v</span><span class="si">{</span><span class="n">pan_python_version</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">version_panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">version_info</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Project v</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">POLICY_VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;dim&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">version_panel</span><span class="p">)</span>

    <span class="c1"># Check if versions meet minimum requirements</span>
    <span class="k">if</span> <span class="n">version_tuple</span><span class="p">(</span><span class="n">pan_os_python_version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version_tuple</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MIN_PAN_OS_PYTHON_VERSION</span><span class="p">):</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold red]ERROR:[/bold red] pan-os-python version </span><span class="si">{</span><span class="n">pan_os_python_version</span><span class="si">}</span><span class="s2"> is lower than the required minimum version </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">MIN_PAN_OS_PYTHON_VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">version_tuple</span><span class="p">(</span><span class="n">pan_python_version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version_tuple</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MIN_PAN_PYTHON_VERSION</span><span class="p">):</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold red]ERROR:[/bold red] pan-python version </span><span class="si">{</span><span class="n">pan_python_version</span><span class="si">}</span><span class="s2"> is lower than the required minimum version </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">MIN_PAN_PYTHON_VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Load menu options from JSON file</span>
    <span class="n">menu_options</span> <span class="o">=</span> <span class="n">parse_metadata_from_json</span><span class="p">(</span><span class="s2">&quot;Menu Options&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">POLICY_TARGETS_FILENAME</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">menu_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load menu options from </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">POLICY_TARGETS_FILENAME</span><span class="si">}</span><span class="s2">. Aborting script execution...&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">menu_options</span></div>



<div class="viewcode-block" id="display_menu">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.display_menu">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">display_menu</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays a menu of options for the user to select from.</span>

<span class="sd">    Prints each option with a numbered list. The default choice, if specified,</span>
<span class="sd">    is indicated with an asterisk. Prompts the user to select an option,</span>
<span class="sd">    notifying about the default option when pressing Enter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if default_choice is a valid key in menu_options</span>
    <span class="n">valid_default</span> <span class="o">=</span> <span class="n">default_choice</span> <span class="ow">in</span> <span class="n">menu_options</span> <span class="k">if</span> <span class="n">menu_options</span> <span class="ow">and</span> <span class="n">default_choice</span> <span class="k">else</span> <span class="kc">False</span>
    
    <span class="c1"># Determine which option should be marked as default</span>
    <span class="n">effective_default</span> <span class="o">=</span> <span class="n">default_choice</span> <span class="k">if</span> <span class="n">valid_default</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">menu_options</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">menu_options</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">menu_content</span> <span class="o">=</span> <span class="s2">&quot;Please select an option (press Enter for default *):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">option</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">menu_options</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">default_indicator</span> <span class="o">=</span> <span class="s2">&quot; * &quot;</span> <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="n">effective_default</span> <span class="k">else</span> <span class="s2">&quot;   &quot;</span>
        <span class="n">menu_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">default_indicator</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">option</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    
    <span class="c1"># Add exit option</span>
    <span class="n">menu_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    0. Exit</span><span class="se">\n</span><span class="s2">&quot;</span>
    
    <span class="c1"># Add note about where to update menu options</span>
    <span class="n">menu_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[dim]Note: Menu options are defined in </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">POLICY_TARGETS_FILENAME</span><span class="si">}</span><span class="s2">[/dim]&quot;</span>

    <span class="n">panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">menu_content</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Select the policy deployment target&quot;</span><span class="p">,</span> <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_user_choice">
<a class="viewcode-back" href="../../lib/auxiliary_functions.html#lib.auxiliary_functions.get_user_choice">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_choice</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompts the user to select an option from a list of choices.</span>

<span class="sd">    The options are indexed starting from 1 up to the number of available options. The user is prompted to enter</span>
<span class="sd">    their choice as a number within this range. If the user simply presses Enter without entering a number,</span>
<span class="sd">    the function returns the index of the default option. If the user enters 0, the function returns 0 to indicate</span>
<span class="sd">    the exit option was selected.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The index of the user&#39;s selected choice, the index of the default choice if no input is provided,</span>
<span class="sd">             or 0 if the exit option was selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_options</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">menu_options</span><span class="p">)</span>
    <span class="c1"># Check if default_choice is a valid key in menu_options</span>
    <span class="n">valid_default</span> <span class="o">=</span> <span class="n">default_choice</span> <span class="ow">in</span> <span class="n">menu_options</span> <span class="k">if</span> <span class="n">menu_options</span> <span class="ow">and</span> <span class="n">default_choice</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="c1"># Determine which option should be used as default</span>
    <span class="n">effective_default</span> <span class="o">=</span> <span class="n">default_choice</span> <span class="k">if</span> <span class="n">valid_default</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">menu_options</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">menu_options</span> <span class="k">else</span> <span class="kc">None</span>
    
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter your choice (0-</span><span class="si">{</span><span class="n">num_options</span><span class="si">}</span><span class="s2">, Enter for default *): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">effective_default</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">menu_options</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">effective_default</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Return the index of the effective default choice</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># This should not happen if menu_options is properly loaded</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No default option available. Please make a selection.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Exit option</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">choice</span> <span class="o">&lt;=</span> <span class="n">num_options</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">choice</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please enter a number between 0 and </span><span class="si">{</span><span class="n">num_options</span><span class="si">}</span><span class="s2">, or press Enter for default.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid input, please enter a number or press Enter for the default option.&quot;</span><span class="p">)</span></div>

</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Nikolay Matveev
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2025, Nikolay Matveev; Companion book copyright 2025, Packt Publishing Ltd. - All Rights Reserved..
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>